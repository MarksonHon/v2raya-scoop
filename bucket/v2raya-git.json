{
    "commit_sha": "ec7d955e7c6065a1b9abf1bc69354ca91639e26e",
    "version": "20220322T1434336303",
    "description": "v2rayA is a V2Ray client supporting global transparent proxy(Linux Only), compatible with SS, SSR, Trojan(trojan-go), PingTunnel protocols.",
    "homepage": "https://github.com/v2rayA/v2rayA",
    "license": "AGPL-3.0-only",
    "url": "https://github.com/v2rayA/v2rayA/archive/refs/heads/master.zip",
    "installer": {
        "script": [
            "Set-Location $dir/v2rayA-master",
            "# zip web files",
            "Function Gzip-File([ValidateScript({Test-Path $_})][string]$File){",
            "    $srcFile = Get-Item -Path $File",
            "    $newFileName = \"$($srcFile.FullName).gz\"",
            "    try",
            "    {",
            "        $srcFileStream = New-Object System.IO.FileStream($srcFile.FullName,([IO.FileMode]::Open),([IO.FileAccess]::Read),([IO.FileShare]::Read))",
            "        $dstFileStream = New-Object System.IO.FileStream($newFileName,([IO.FileMode]::Create),([IO.FileAccess]::Write),([IO.FileShare]::None))",
            "        $gzip = New-Object System.IO.Compression.GZipStream($dstFileStream,[System.IO.Compression.CompressionMode]::Compress)",
            "        $srcFileStream.CopyTo($gzip)",
            "    } ",
            "    catch",
            "    {",
            "        Write-Host \"$_.Exception.Message\" -ForegroundColor Red",
            "    }",
            "    finally",
            "    {",
            "        $gzip.Dispose()",
            "        $srcFileStream.Dispose()",
            "        $dstFileStream.Dispose()",
            "    }",
            "}",
            "go clean",
            "if (Get-Command pwsh -ErrorAction Ignore) {",
            "    pwsh -c ./build-in-pwsh.ps1",
            "}",
            "else {",
            "    Write-Host \"We didn't find PowerShell Core on your computer, it is going to use Windows PowerShell to build v2rayA. However, building in PowerShell Core is suggest.\"",
            "    powershell -c ./build-in-pwsh.ps1",
            "}",
            "# Get date",
            "$DateLong = git log -1 --format=\"%cd\" --date=short",
            "$Date = $DateLong -replace \"-\"; \"\"",
            "# Other infos",
            "$count = git rev-list --count HEAD",
            "$commit = git rev-parse --short HEAD",
            "# Version",
            "$version = \"unstable-$date.r$count.$commit\"",
            "# Disable CGO",
            "${env:CGO_ENABLED} = \"0\"",
            "# Set AMD64 CPU Version",
            "# See https://go.dev/doc/go1.18 for more informations",
            "${env:GOAMD64} = \"v2\"",
            "## Set yarn's output path",
            "${env:OUTPUT_DIR} = \"$SHELL_FOLDER/service/server/router/web\"",
            "# Build v2rayA",
            "$guiPath = $SHELL_FOLDER + \"/gui\"",
            "Set-Location -Path \"$guiPath\"",
            "yarn; yarn build",
            "Get-ChildItem \"$SHELL_FOLDER/service/server/router/web\" -recurse |Where-Object{$_.PSIsContainer -eq $False}|ForEach-Object -Process{",
            "    if($_.Extension -ne \".png\" -and $_.Extension -ne \".gz\" -and $_.Name -ne \"index.html\"){",
            "        Gzip-File($_.FullName)",
            "        Remove-Item -Path $_.FullName",
            "    }",
            "}",
            "$corePath = $SHELL_FOLDER + \"/service\"",
            "Set-Location -path \"$corePath\"",
            "go build -ldflags \"-X github.com/v2rayA/v2rayA/conf.Version=$version -s -w\" -o \"$SHELL_FOLDER/$v2rayaBin\"",
            "Move-Item $dir\\v2rayA-master\\v2raya.exe $dir\\v2rayaWin-git.exe",
            "Set-Location ~",
            "Remove-Item -Force -Recurse $dir\\v2rayA-master"
        ]
    },
    "bin": [
        [
            "v2rayaWin-git.exe",
            "v2raya-git",
            "--lite"
        ],
        [
            "v2rayaWin-git.exe",
            "v2rayaWin-git"
        ]
    ],
    "depends": [
        "v2ray",
        "yarn",
        "nodejs-lts",
        "go"
    ],
    "suggest": ["v2raya/v2ray-rules-dat","dorado/powershell"],
    "env_set": {
        "V2RAYA_V2RAY_BIN": "$scoopdir\\apps\\v2ray\\current\\v2ray.exe"
    }
}